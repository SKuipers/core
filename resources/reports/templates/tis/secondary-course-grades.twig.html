{#<!--
name: Secondary Course Grades
category: Secondary
types: Body
sources:
    reportingCycle: ReportingCycle
    courseList: CourseList
config:
    reportNames:
        label: Report Names
        type: text
        default: Term 1 Interim,Term 1 End,Term 2 Interim,Term 2 End
    commentSize:
        label: Comment Size
        type: number
        default: 9.5
    classNotesFirst:
        label: Class Notes First?
        type: yesno
        default: Y
    marksHeading:
        label: Marks & Effort Heading?
        type: yesno
        default: Y
    effortColumn:
        label: Effort Column?
        type: yesno
        default: Y
    percentColumn:
        label: Final Percent Column?
        type: yesno
        default: Y
-->#}
{{- stylesheet ? include(stylesheet) -}}<style>
    .header {
        
        font-weight: bold;
        background-color: #AAAAAA;
        vertical-align: middle;
    }

    .subheader {
        font-size: 8pt ;
        text-align: center;
        line-height: 1.15;
    }

    .outcome {
        font-size: 8pt ;
        text-align: left;
        line-height: 1;
    }

    .rowheader {
        font-size: 8pt ;
        text-align: center;
        {{ config.marksHeading == 'Y' ? 'line-height: 4.25;' }}
    }

    .comment {
        font-size: {{ config.commentSize|default(9.5) }}pt;
        line-height: 1.4;
        text-align: justified;
    }
</style>{% for course in courseList %}<table cellspacing="0" cellpadding="4" nobr="true">
    <tr>
        <td class="header border-top border-bottom border-left" style="width:50%" colspan="6">{{ course.name|upper }}</td>
        <td class="header border-top border-bottom border-right" style="width:50%;text-align:right;" colspan="7">
        {% if (course.nameShort == 'OTH3998' or course.nameShort == 'OTH3999') and course.comments.writtenBy is not empty %}
            {{- course.comments.writtenBy -}}
        {% else %}
            {% for teacher in course.teachers %}
                {% if (loop.index % 3) == 1 %}<br/>{% endif %}
                {{- teacher.fullName -}}
                {{ not loop.last ? ',' : '' }}
            {% endfor %}
        {% endif %}
        </td>
    </tr>

    {% if config.classNotesFirst == 'Y' %}
    <tr>
        <td class="border" colspan="13"><table cellpadding="6"><tr>
            {% if "1-" in (course.classes|first).classNameShort and course.comments.comment is empty %}
                {% set defaultComment = "This course was completed last semester. Please refer to the Semester 1 report for details." %}
            {% elseif "2-" in (course.classes|first).classNameShort and course.comments.comment is empty  %}
                {% set defaultComment = "This course will begin later in the Academic Year. No comments or grades are available at this time." %}
            {% endif %}
            <td class="comment"><b>Course&nbsp;Description:</b> <span style="font-family:DroidSansFallback;">{{ course.comments.comment|default(defaultComment) }}</span></td>
            </tr></table>
        </td>
    </tr>
    {% endif %}

    {% set reportNames = config.reportNames|split(',') %}
    
    {% if course.classes %}

        {% set colWidth = 44 / reportingCycle.cycleTotal|default(1) %}
        {% set firstColWidth = config.percentColumn == 'Y' ? 24 : 29 %}
        {% set rowspan = config.marksHeading == 'Y' ? 2 : 1 %}
        <tr>
            <td class="header border rowheader" style="width:{{ firstColWidth }}%" rowspan="{{ rowspan }}">Course</td>
            <td class="header border rowheader" style="width:13%" rowspan="{{ rowspan }}">ID</td>
            <td class="header border rowheader" style="width:7%" rowspan="{{ rowspan }}"> Absent</td>
            <td class="header border rowheader" style="width:7%" rowspan="{{ rowspan }}"> Late</td>

            {% if config.marksHeading == 'Y' %}
            <td class="header border subheader" style="width:49%" colspan="9">Marks & Effort</td>
            </tr>
            <tr>
            {% endif %}

            {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
            <td class="header border subheader" style="width:{{ colWidth }}%" colspan="2">{{ reportNames[cycleNum-1]|replace({"Interim":"\nInterim"})|nl2br }}</td>
            {% endfor %}

            {% if config.percentColumn == 'Y' %}
            <td class="header border subheader" style="width:5%"> %</td>
            {% endif %}
        </tr>

        
        {% for class in course.classes %}
        <tr>
            <td class="border subheader" style="width:{{ firstColWidth }}%">{{ class.courseName }}</td>
            <td class="border subheader" style="width:13%">{{ class.courseNameShort }}.{{ class.classNameShort }}</td>
            <td class="border subheader" style="width:7%">{{ loop.first ? class.attendance.absent|default(0) : ' -' }}</td>
            <td class="border subheader" style="width:7%">{{ loop.first ? class.attendance.late|default(0) : ' -' }}</td>
            
            {% set grades = class.grades %}
            {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
                {% set showGrade = grades[cycleNum].grade is not empty %}
                {% set showEffort = grades[cycleNum].effort.value is not empty %}
                {% set gradeValue = (grades[cycleNum]['final grade'] is not empty ? grades[cycleNum]['final grade'].value : grades[cycleNum]['term grade'].value) %}

                {% if config.effortColumn == 'Y' %}
                    <td class="border subheader" style="width:{{ colWidth / 2 }}%">{{ term.active and not showGrade ? ' -' : gradeValue }}</td>
                    <td class="border subheader" style="width:{{ colWidth / 2 }}%">{{ term.active and not showEffort ? ' -' : grades[cycleNum].effort.value }}</td>
                {% else %}
                    <td class="border subheader" style="width:{{ colWidth }}%" colspan="2">{{ term.active and not showGrade ? ' -' : gradeValue }}</td>
                {% endif %}
            {% endfor %}

            {% if config.percentColumn == 'Y' %}
                <td class="border subheader" style="width:5%">
                {% set finalGrade = grades | last %}
                
                {% if finalGrade.finalPercent is not empty %}
                    {{ finalGrade.finalPercent }}
                {% endif %}
                </td>
            {% endif %}
        </tr>
        


        {% if class.grades['Transferable Skills'] %}
            <tr>
                <td class="border-left border-top border-bottom subheader" style="width:{{ 27 + firstColWidth }}%; text-align: left;" colspan="2"><b>Transferable Skills</b></td>
                <td class="border-right border-top border-bottom subheader" style="width:{{ config.percentColumn == 'Y' ? '49' : '44' }}%" colspan="{{ termDefaults|length * 2 }}"></td>
            </tr>
            
            {% for outcome, values in class.grades['Transferable Skills'] %}
            <tr>
                <td class="border outcome" style="width:{{ 27 + firstColWidth }}%;" colspan="2">{{ outcome }}</td>
                {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
                    <td class="border outcome" style="width:{{ colWidth }}%; text-align: center;" colspan="2">{{ values[cycleNum] }}</td>
                {% endfor %}

                {% if config.percentColumn == 'Y' %}
                <td class="border subheader" style="width:5%"></td>
                {% endif %}
            </tr>
            {% endfor %}
        {% endif %}
        
        {% endfor %}

    {% endif %}

    {% if config.classNotesFirst == 'N' and course.comments.comment is not empty %}
    <tr nobr="true">
        <td class="border" colspan="13" style="width:100%"><table cellpadding="6"><tr>
            <td class="comment"><b>Course&nbsp;Description:</b> <span style="font-family:DroidSansFallback;">{{ course.comments.comment }}</span></td>
            </tr></table>
        </td>
    </tr>
    {% endif %}

    {% if course.role != 'Student - Left' and (course.classes|first).grades[reportingCycle.cycleNumber].comment.value %}
    <tr>
        <td class="border" colspan="{% if course.hasCredits %}14{% else %}13{% endif %}" style="width:100%"><table cellpadding="6"><tr>
            <td class="comment"><b>Teacher<span style="color:white">-</span>Comments:</b> <span style="font-family:DroidSansFallback;">{{ (course.classes|first).grades[reportingCycle.cycleNumber].comment.value }}</span></td>
            </tr></table>
        </td>
    </tr>
    {% endif %}
</table><table cellspacing="0" cellpadding="0" style="height: 3.5mm;font-size: 3.5mm;">
<tr><td></td></tr>
</table>
{% endfor %}
