{#<!--
name: Secondary Course Grades - Semestered
category: Body
types: Body
sources:
    courseList: CourseListSemestered
-->#}
{{- include('tis/secondary-style.twig') -}}<style>
    .header {
        
        font-weight: bold;
        background-color: #AAAAAA;
        vertical-align: middle;
    }

    .subheader {
        font-size: {{ fontSizeSmall }} ;
        text-align: center;
        line-height: 1.15;
    }

    .outcome {
        font-size: {{ fontSizeSmall }} ;
        text-align: left;
        line-height: 1;
    }

    .rowheader {
        font-size: {{ fontSizeSmall }} ;
        text-align: center;
        line-height: 4.25;
    }

    .comment {
        
        font-size: {{ fontSizeComment }} ;
        line-height: {{ lineHeightComment }};
        text-align: justified;
    }
</style>{% for course in courseList %}<table cellspacing="0" cellpadding="0" style="height: 3.5mm;font-size: 3.5mm;">
<tr><td></td></tr>
</table><table cellspacing="0" cellpadding="4" nobr="true">
    <tr>
        <td class="header border-top border-bottom border-left" style="width:50%" colspan="6">{{ course.name|upper }}</td>
        <td class="header border-top border-bottom border-right" style="width:50%;text-align:right;" colspan="6">
        {% if (course.nameShort == 'OTH3998' or course.nameShort == 'OTH3999') and course.comments.writtenBy is not empty %}
            {{- course.comments.writtenBy -}}
        {% else %}
            {% for teacher in course.teachers %}
                {% if (loop.index % 3) == 1 %}<br/>{% endif %}
                {{- teacher.fullName -}}
                {{ not loop.last ? ',' : '' }}
            {% endfor %}
        {% endif %}
        </td>
    </tr>

    <tr>
        <td class="border" colspan="12"><table cellpadding="6"><tr>
            {% if "1-" in (course.classes|first).classNameShort and course.comments.comment is empty %}
                {% set defaultComment = "This course was completed last semester. Please refer to the Semester 1 report for details." %}
            {% elseif "2-" in (course.classes|first).classNameShort and course.comments.comment is empty  %}
                {% set defaultComment = "This course will begin later in the Academic Year. No comments or grades are available at this time." %}
            {% endif %}
            <td class="comment"><b>Course&nbsp;Description:</b> <span style="font-family:DroidSansFallback;">{{ course.comments.comment|default(defaultComment) }}</span></td>
            </tr></table>
        </td>
    </tr>

    {% set reportNames = {
        1: 'Term 1 Interim', 
        2: 'Term 1 End ', 
        3: 'Term 2 Interim', 
        4: 'Term 2 End', 
    } %}

    {% set reportingCycle = {
        cycleNumber: 1,
        cycleTotal: 4,
    } %}
    
    {% if course.classes %}
    <tr>
        <td class="header border rowheader" style="width:24%" rowspan="2">Course</td>
        <td class="header border rowheader" style="width:13%" rowspan="2">ID</td>
        <td class="header border rowheader" style="width:7%" rowspan="2"> Absent</td>
        <td class="header border rowheader" style="width:7%" rowspan="2"> Late</td>

        <td class="header border subheader" style="width:49%" colspan="8">Marks & Effort</td>
    </tr>
    <tr>
        {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
        <td class="header border subheader" style="width:11%" colspan="2">{{ reportNames[cycleNum]|replace({"Interim":"\nInterim", "End":"\nEnd"})|nl2br }}</td>
        {% endfor %}

        <td class="header border subheader" style="width:5%"> %</td>
    </tr>

    {% for class in course.classes %}
    <tr>
        <td class="border subheader" style="width:24%">{{ class.courseName }}</td>
        <td class="border subheader" style="width:13%">{{ class.courseNameShort }}.{{ class.classNameShort }}</td>
        <td class="border subheader" style="width:7%">{{ loop.first ? class.attendance.absent|default(0) : ' -' }}</td>
        <td class="border subheader" style="width:7%">{{ loop.first ? class.attendance.late|default(0) : ' -' }}</td>
        
        

        {% set grades = class.grades %}
        {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
            {% set showGrade = grades[cycleNum].grade is not empty %}
            {% set showEffort = grades[cycleNum].effort.value is not empty %}
            {% set gradeValue = (grades[cycleNum]['final grade'] is not empty ? grades[cycleNum]['final grade'].value : grades[cycleNum]['term grade'].value) %}

            <td class="border subheader" style="width:5.5%">{{ term.active and not showGrade ? ' -' : gradeValue }}</td>
            <td class="border subheader" style="width:5.5%">{{ term.active and not showEffort ? ' -' : grades[cycleNum].effort.value }}</td>
        {% endfor %}

        <td class="border subheader" style="width:5%">
        {% set finalGrade = grades | last %}
        
        {% if finalGrade.finalPercent is not empty %}
            {{ finalGrade.finalPercent }}
        {% endif %}
        </td>
    </tr>
    {% endfor %}


    {% if course.outcomes %}
        {# --- COMMENTED OUT FOR TIS ---
        <tr>
            <td class="border-left border-top border-bottom subheader" style="width:51%; text-align: left;" colspan="2"><b>Transferable Skills</b></td>
            <td class="border-right border-top border-bottom subheader" style="width:49%" colspan="{{ termDefaults|length * 2 }}"></td>
        </tr>
        #}
        
        {% for outcome, grades in course.outcomes %}
        <tr>
            <td class="border outcome" style="width:51%;" colspan="2">{{ outcome }}</td>
            {% for cycleNum in range(1, reportingCycle.cycleTotal|default(1)) %}
                <td class="border outcome" style="width:11%; text-align: center;" colspan="2">{{ grades[cycleNum] }}</td>
            {% endfor %}
            <td class="border subheader" style="width:5%"></td>
        </tr>
        {% endfor %}
    {% endif %}
    

    {% endif %}

    {% if course.role != 'Student - Left' and (course.classes|first).grades[reportingCycle.cycleNumber].comment.value %}
    <tr>
        <td class="border" colspan="{% if course.hasCredits %}13{% else %}12{% endif %}" style="width:100%"><table cellpadding="6"><tr>
            <td class="comment"><b>Teacher<span style="color:white">-</span>Comments:</b> <span style="font-family:DroidSansFallback;">{{ (course.classes|first).grades[reportingCycle.cycleNumber].comment.value }}</span></td>
            </tr></table>
        </td>
    </tr>
    {% endif %}
</table>{% endfor %}
